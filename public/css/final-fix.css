/* 
 * Final Comprehensive Fix for Gallery Stacking
 */

/* ---- Phase 1: Reset all height and overflow constraints ---- */
html, body, div, main, section, article, aside, header, footer, nav {
  overflow: visible !important;
  max-height: none !important;
  min-height: 0 !important;
  height: auto !important;
}

body.viewer-page {
  overflow: auto !important;
  height: 100% !important;
  min-height: 100vh !important;
}

body.viewer-page .app-container {
  min-height: 100vh !important;
  height: auto !important;
}

body.viewer-page .viewer-content {
  min-height: 100vh !important;
  height: auto !important;
  overflow: visible !important;
}

/* ---- Phase 2: Force Flexbox Layout (since Grid has issues) ---- */
body.viewer-page .image-gallery.grid-view {
  /* Reset any previous layout */
  position: static !important;
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: wrap !important;
  
  /* Generous spacing */
  gap: 80px !important;
  padding: 80px !important;
  
  /* Basic properties */
  width: 100% !important;
  box-sizing: border-box !important;
  
  /* Reset any height constraints */
  height: auto !important;
  max-height: none !important;
  min-height: 0 !important;
  
  /* Fix overflow */
  overflow: visible !important;
  
  /* Visual indicator */
  background-color: rgba(0, 0, 255, 0.05) !important;
  outline: 5px solid blue !important;
}

/* ---- Phase 3: Fix Card Layout with Aspect Ratio ---- */
body.viewer-page .grid-view .image-card {
  /* Make 4 cards per row with gaps */
  flex: 0 0 calc(25% - 60px) !important;
  
  /* Used to maintain aspect ratio */
  height: 0 !important;
  padding-bottom: calc(25% - 60px) !important;
  
  /* Position relative for children */
  position: relative !important;
  
  /* Basic styling */
  margin: 0 !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  
  /* Visual indicator */
  outline: 3px solid red !important;
}

/* ---- Phase 4: Fix Image Position ---- */
body.viewer-page .grid-view .image-card img.card-image {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* ---- Phase 5: Mobile Adjustments ---- */
@media (max-width: 768px) {
  body.viewer-page .image-gallery.grid-view {
    gap: 20px !important;
    padding: 20px !important;
  }
  
  body.viewer-page .grid-view .image-card {
    flex: 0 0 calc(50% - 10px) !important;
    padding-bottom: calc(50% - 10px) !important;
  }
}

/* ---- Phase 6: Fix for specific browser issues ---- */
@supports (-ms-ime-align:auto) {
  /* Edge-specific fixes */
  body.viewer-page .image-gallery.grid-view {
    display: block !important;
  }
  
  body.viewer-page .grid-view .image-card {
    display: inline-block !important;
    width: calc(25% - 60px) !important;
    margin: 30px !important;
  }
}

/* ---- Phase 7: Force reflow ---- */
body.viewer-page .image-gallery::before {
  content: '' !important;
  display: table !important;
  clear: both !important;
}

body.viewer-page .image-gallery::after {
  content: '' !important;
  display: table !important;
  clear: both !important;
}
